<form action="{% url 'events:save-event' %}" method="post">
{% csrf_token %}
<fieldset>
    <legend><h1>Create an Event</h1></legend>
    {% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}
    <label for="event_name">Event Name:</label>
    <input type="text" name="event_name" id="event_name" placeholder="Add Event Name" required>
    
    <label for="start_time">Start Time:</label>
    <input type="datetime-local" name="start_time" id="start_time" required>
    
    <label for="end_time">End Time:</label>
    <input type="datetime-local" name="end_time" id="end_time" required>

    <label for="capacity">Capacity:</label>
    <input type="number" name="capacity" id="capacity" placeholder="Capacity" required>

    <input type="hidden" id="selected-location-id" name="event_location_id"> <!-- Hidden input to store the ID -->
    <label for="autocomplete-input">Location:</label>
    <input type="text" name="location" placeholder="Location" id="autocomplete-input" required>
    <ul id="autocomplete-list"></ul></fieldset>
<input type="submit" value="CREATE">
</form>

<!-- HTML -->

<script type="text/javascript">

const input = document.getElementById('autocomplete-input');
        const list = document.getElementById('autocomplete-list');
        const selectedIdInput = document.getElementById('selected-location-id');

        // Replace 'YOUR_API_ENDPOINT' with the actual API endpoint you want to use.
        const API_ENDPOINT = '/locations/autocomplete/?term=';

        input.addEventListener('input', async function () {
            const query = input.value.toLowerCase();
            list.innerHTML = '';

            if (query) {
                try {
                    const response = await fetch(API_ENDPOINT + query);
                    const data = await response.json();

                    data.forEach(function (item) {
                        const listItem = document.createElement('li');
                        listItem.textContent = item.text; // Display the name
                        listItem.addEventListener('click', function () {
                            input.value = item.text; // Set the id as the input field's value
                            selectedIdInput.value = item.id; // Store the ID in the hidden input
                            list.innerHTML = '';
                        });
                        list.appendChild(listItem);
                    });
                } catch (error) {
                    console.error('Error fetching data from the API:', error);
                }
            }
        });

        document.addEventListener('click', function (event) {
            if (event.target !== input) {
                list.innerHTML = '';
            }
        });
</script>
